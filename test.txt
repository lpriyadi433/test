-- Movement Menu Sederhana (Tanpa Rayfield)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

-- Vars
local WalkSpeedEnabled = false
local CustomWalkSpeed = 16
local FlyEnabled = false
local FlySpeed = 100
local BodyGyro, BodyVelocity, FlyConn
local Minimized = false

-- Parent aman
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MovementMenu"
ScreenGui.ResetOnSpawn = false
if gethui then
    ScreenGui.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
else
    ScreenGui.Parent = Player:WaitForChild("PlayerGui")
end

-- Frame utama
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 320, 0, 260)
Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(45,45,45)
Frame.BorderSizePixel = 0

-- Tombol Close (X)
local CloseBtn = Instance.new("TextButton", Frame)
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.Font = Enum.Font.SourceSansBold
CloseBtn.TextScaled = true
CloseBtn.Text = "X"
CloseBtn.ZIndex = 2
CloseBtn.MouseButton1Click:Connect(function()
    -- Auto OFF semua fitur saat menu ditutup
    WalkSpeedEnabled = false
    Humanoid.WalkSpeed = 16
    if FlyEnabled then
        FlyEnabled = false
        if FlyConn then FlyConn:Disconnect() end
        if BodyVelocity then BodyVelocity:Destroy() end
        if BodyGyro then BodyGyro:Destroy() end
        Humanoid.PlatformStand = false
    end
    ScreenGui:Destroy()
end)

-- Tombol Minimize (-)
local MinBtn = Instance.new("TextButton", Frame)
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -70, 0, 5)
MinBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
MinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinBtn.Font = Enum.Font.SourceSansBold
MinBtn.TextScaled = true
MinBtn.Text = "-"
MinBtn.ZIndex = 2

-- Judul
local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,40)
Title.BackgroundColor3 = Color3.fromRGB(255,255,255)
Title.Text = "MENU PLAYER"
Title.Font = Enum.Font.SourceSansBold
Title.TextScaled = true
Title.TextColor3 = Color3.fromRGB(0,0,0)

-- === Konten Menu ===
local Content = Instance.new("Frame", Frame)
Content.Size = UDim2.new(1,0,1,-40)
Content.Position = UDim2.new(0,0,0,40)
Content.BackgroundTransparency = 1

-- === WalkSpeed ===
local WalkBtn = Instance.new("TextButton", Content)
WalkBtn.Size = UDim2.new(0,80,0,30)
WalkBtn.Position = UDim2.new(0,10,0,20)
WalkBtn.Text = "OFF"
WalkBtn.BackgroundColor3 = Color3.fromRGB(255,49,93)
WalkBtn.TextColor3 = Color3.fromRGB(255,255,255)
WalkBtn.Font = Enum.Font.SourceSansBold
WalkBtn.TextScaled = true

local WalkLabel = Instance.new("TextLabel", Content)
WalkLabel.Size = UDim2.new(0,150,0,30)
WalkLabel.Position = UDim2.new(0,100,0,20)
WalkLabel.BackgroundTransparency = 1
WalkLabel.Text = "WalkSpeed"
WalkLabel.TextColor3 = Color3.fromRGB(255,255,255)
WalkLabel.Font = Enum.Font.SourceSansBold
WalkLabel.TextScaled = true

-- Slider WalkSpeed
local WalkSliderFrame = Instance.new("Frame", Content)
WalkSliderFrame.Size = UDim2.new(0,200,0,20)
WalkSliderFrame.Position = UDim2.new(0,10,0,60)
WalkSliderFrame.BackgroundColor3 = Color3.fromRGB(80,80,80)

local WalkFill = Instance.new("Frame", WalkSliderFrame)
WalkFill.Size = UDim2.new(CustomWalkSpeed/200,0,1,0)
WalkFill.BackgroundColor3 = Color3.fromRGB(0,200,0)

local WalkValue = Instance.new("TextLabel", Content)
WalkValue.Size = UDim2.new(0,100,0,20)
WalkValue.Position = UDim2.new(0,220,0,60)
WalkValue.BackgroundTransparency = 1
WalkValue.Text = tostring(CustomWalkSpeed)
WalkValue.TextColor3 = Color3.fromRGB(255,255,255)
WalkValue.Font = Enum.Font.SourceSansBold
WalkValue.TextScaled = true

-- === Fly ===
local FlyBtn = Instance.new("TextButton", Content)
FlyBtn.Size = UDim2.new(0,80,0,30)
FlyBtn.Position = UDim2.new(0,10,0,100)
FlyBtn.Text = "OFF"
FlyBtn.BackgroundColor3 = Color3.fromRGB(255,49,93)
FlyBtn.TextColor3 = Color3.fromRGB(255,255,255)
FlyBtn.Font = Enum.Font.SourceSansBold
FlyBtn.TextScaled = true

local FlyLabel = Instance.new("TextLabel", Content)
FlyLabel.Size = UDim2.new(0,150,0,30)
FlyLabel.Position = UDim2.new(0,100,0,100)
FlyLabel.BackgroundTransparency = 1
FlyLabel.Text = "Fly Player"
FlyLabel.TextColor3 = Color3.fromRGB(255,255,255)
FlyLabel.Font = Enum.Font.SourceSansBold
FlyLabel.TextScaled = true

-- Slider FlySpeed
local FlySliderFrame = Instance.new("Frame", Content)
FlySliderFrame.Size = UDim2.new(0,200,0,20)
FlySliderFrame.Position = UDim2.new(0,10,0,140)
FlySliderFrame.BackgroundColor3 = Color3.fromRGB(80,80,80)

local FlyFill = Instance.new("Frame", FlySliderFrame)
FlyFill.Size = UDim2.new(FlySpeed/300,0,1,0)
FlyFill.BackgroundColor3 = Color3.fromRGB(0,200,255)

local FlyValue = Instance.new("TextLabel", Content)
FlyValue.Size = UDim2.new(0,100,0,20)
FlyValue.Position = UDim2.new(0,220,0,140)
FlyValue.BackgroundTransparency = 1
FlyValue.Text = tostring(FlySpeed)
FlyValue.TextColor3 = Color3.fromRGB(255,255,255)
FlyValue.Font = Enum.Font.SourceSansBold
FlyValue.TextScaled = true

-- === Minimize Logic ===
MinBtn.MouseButton1Click:Connect(function()
    Minimized = not Minimized
    if Minimized then
        Content.Visible = false
        Frame.Size = UDim2.new(0, 320, 0, 40)
        MinBtn.Text = "+"
    else
        Content.Visible = true
        Frame.Size = UDim2.new(0, 320, 0, 260)
        MinBtn.Text = "-"
    end
end)

-- === Drag Title ===
local dragging, dragInput, dragStart, startPos
Title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Title.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- === Sisa Logic (Walk & Fly, Slider) ===
-- ... (pakai yang sudah ada di scriptmu, tinggal ganti parent jadi Content untuk tombol/slider)
